package testcases;

import factoryRequest.FactoryRequest;
import factoryRequest.RequestInformation;
import factoryRequest.ResponseInformation;
import org.json.JSONObject;
import org.junit.jupiter.api.Test;
import utils.ConfigOwaspAPI;

public class VulnerabilityTest {

    @Test
    public void startVulnerabilityScanner(){
        // #1 iniciar el scaneo
        RequestInformation information = new RequestInformation();
        information.setUrl(ConfigOwaspAPI.START_SCANNER+"https://todoist.com/");

        ResponseInformation responseInformation= FactoryRequest.make("get").send(information);
        JSONObject body = new JSONObject(responseInformation.getBody());
        String idScanner=body.get("scan").toString();
        System.out.println("********** ID "+idScanner);

        // #2 verificar el estado del scanero
        // si esta en 100% pasar a la generacion de reportes
        String percentage="0";
        information.setUrl(ConfigOwaspAPI.GET_PROGRESS+idScanner);
        while(!percentage.equals("100")){
            try {
                Thread.sleep(5000);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            responseInformation=FactoryRequest.make("get").send(information);
            body = new JSONObject(responseInformation.getBody());
            percentage=body.get("status").toString();
            System.out.println("STATUS ----> "+percentage);
        }

        // #3 si es 100% generar reporte
        information.setUrl(ConfigOwaspAPI.GET_REPORT);
        responseInformation=FactoryRequest.make("get").send(information);

        // #4 adicionar el reporte de tipos de vulnerabilidades+#alertas
        information.setUrl(ConfigOwaspAPI.GET_ATACK+idScanner);
        responseInformation=FactoryRequest.make("get").send(information);




    }

}
